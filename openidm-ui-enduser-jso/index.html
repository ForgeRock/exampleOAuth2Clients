<!--
  Copyright 2015-2017 ForgeRock AS. All Rights Reserved

  Use of this code requires a commercial software license with ForgeRock AS.
  or with one of its affiliates. All use shall be exclusively subject
  to such license between the licensee and ForgeRock AS.
-->
<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>OpenIDM</title>

</head>

<body style="display:none">

<div id="messages"></div>
<div id="wrapper"></div>
<div id="popup">
    <div id="popup-content" class="radious"></div>
</div>

<div id="dialog-background"></div>
<div id="dialogs"></div>

<footer id="footer" class="footer"></footer>

<!-- JSO: initializing the client:  https://github.com/andreassolberg/jso#how-to-use -->

<!-- JSO: getting the library -->
<script type="text/javascript" src="https://unpkg.com/jso/dist/jso.js"></script>

<script>
    var JSO_CLIENT;
    
    /* JSO: 
        configuring the JSO object for ForgeRock OAuth 2.0 Provider with the client specific settings and assigning it to a global variable, accessible throughout the application
        "redirect_uri" parameter needs to match exactly one of the Redirection URIs registered for this OAuth 2.0 Client in the authorization server
        "authorization" parameter is populated with a well-known end point, which can be discovered in the OpenID Provider Configuration Document, in this case - at http://am-service.sample.svc.cluster.local/openam/oauth2/.well-known/openid-configuration?f=jsonp
    */
    JSO_CLIENT = new jso.JSO({
        providerID: "forgerock",
        client_id: "openidm-ui-enduser-jso",
        redirect_uri: window.location.origin,
        authorization: "http://am-service.sample.svc.cluster.local:80/openam/oauth2/authorize",
        scopes: { 
            request: [
                "openid",
                "profile",
                "consent_read",
                "workflow_tasks",
                "notifications"
            ]
        },
        debug: true
    });

    /* JSO: processing response from the authorization server */
    try {
        JSO_CLIENT.callback();
    } catch (e) {
        /* JSO: process error returned from the callback and, optionally, redirect to an appropriate screen */

        /* JSO: for example: if the resource owner (which we know and love as "user") denies access to its resources, the error may look like:
            {
                "error_description": "Resource Owner did not authorize the request",
                "state": "xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx", 
                "error":"access_denied"
            }
        */

        var message;

        message = 'error';

        if (e.error) {
            message = e.error;

            if (e.error_description) {
                message += ': ' + e.error_description;
            }
        }

        if (message) {
            alert(message);
        }
        /* JSO: for example: end */
    }
</script>
<!-- JSO: initializing the client: end -->

<script type="text/javascript">
    var require = {
        urlArgs : "v=6.0.0",
        deps : ['main']
    };
</script>
<script data-main="main" src="libs/requirejs-2.1.14-min.js"></script>
</body>
</html>
